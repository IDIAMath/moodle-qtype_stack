if(!Array.indexOf){Array.prototype.indexOf=function(a,b){for(var c=b||0;c<this.length;c++){if(this[c]===a){return c}}return-1}}var Parser=function(a){function b(a){function b(){}b.prototype=a;return new b}var L=1,M=2,N=3,O=4;function c(a,b,c,d){this.type_=a;this.index_=b||0;this.prio_=c||0;this.number_=d!==void 0&&null!==d?d:0;this.toString=function(){switch(this.type_){case 0:return this.number_;case L:case M:case N:return this.index_;case O:return"CALL";default:return"Invalid Token";}}}function d(a,b,c,d){this.tokens=a;this.ops1=b;this.ops2=c;this.functions=d}var P=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Q={"":"\\b","	":"\\t","\n":"\\n","":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function e(a){if("string"==typeof a){P.lastIndex=0;return P.test(a)?"'"+a.replace(P,function(b){var a=Q[b];return"string"==typeof a?a:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+a+"'"}return a}function g(a,b){var c=b.split(/\./),d=a,e;while(e=c.shift()){if(!(e in d)){return!1}d=d[e]}return!0}function h(a,b){var c=b.split(/\./),d=a,e;while(e=c.shift()){d=d[e]}return d}d.prototype={simplify:function simplify(a){a=a||{};var e=[],j=[],k,l,m,n=this.tokens.length,o,p=0;for(p=0;p<n;p++){o=this.tokens[p];var q=o.type_;if(q===0){e.push(o)}else if(q===N&&g(a,o.index_)){o=new c(0,0,0,h(a,o.index_));e.push(o)}else if(q===M&&1<e.length){l=e.pop();k=e.pop();m=this.ops2[o.index_];o=new c(0,0,0,m(k.number_,l.number_));e.push(o)}else if(q===L&&0<e.length){k=e.pop();m=this.ops1[o.index_];o=new c(0,0,0,m(k.number_));e.push(o)}else{while(0<e.length){j.push(e.shift())}j.push(o)}}while(0<e.length){j.push(e.shift())}return new d(j,b(this.ops1),b(this.ops2),b(this.functions))},substitute:function substitute(a,e){if(!(e instanceof d)){e=new K().parse(e+"")}var f=[],g=this.tokens.length,h,k=0;for(k=0;k<g;k++){h=this.tokens[k];var l=h.type_;if(l===N&&h.index_===a){for(var m=0;m<e.tokens.length;m++){var n=e.tokens[m],o=new c(n.type_,n.index_,n.prio_,n.number_);f.push(o)}}else{f.push(h)}}var p=new d(f,b(this.ops1),b(this.ops2),b(this.functions));return p},evaluate:function evaluate(a){a=a||{};var b=[],c,d,e,j=this.tokens.length,k,l=0;for(l=0;l<j;l++){k=this.tokens[l];var m=k.type_;if(m===0){b.push(k.number_)}else if(m===M){d=b.pop();c=b.pop();e=this.ops2[k.index_];b.push(e(c,d))}else if(m===N){if(g(a,k.index_)){b.push(h(a,k.index_))}else if(g(this.functions,k.index_)){b.push(h(this.functions,k.index_))}else{throw new Error("undefined variable: "+k.index_)}}else if(m===L){c=b.pop();e=this.ops1[k.index_];b.push(e(c))}else if(m===O){c=b.pop();e=b.pop();if(e.apply&&e.call){if("[object Array]"==Object.prototype.toString.call(c)){b.push(e.apply(void 0,c))}else{b.push(e.call(void 0,c))}}else{throw new Error(e+" is not a function")}}else{throw new Error("invalid Expression")}}if(1<b.length){throw new Error("invalid Expression (parity)")}return b[0]},toString:function toString(a){var b=[],c,d,g,h=this.tokens.length,j,k=0;for(k=0;k<h;k++){j=this.tokens[k];var l=j.type_;if(l===0){b.push(e(j.number_))}else if(l===M){d=b.pop();c=b.pop();g=j.index_;if(a&&"^"==g){b.push("Math.pow("+c+","+d+")")}else{b.push("("+c+g+d+")")}}else if(l===N){b.push(j.index_)}else if(l===L){c=b.pop();g=j.index_;if("-"===g){b.push("("+g+c+")")}else{b.push(g+"("+c+")")}}else if(l===O){c=b.pop();g=b.pop();b.push(g+"("+c+")")}else{throw new Error("invalid Expression")}}if(1<b.length){throw new Error("invalid Expression (parity)")}return b[0]},variables:function variables(){for(var a=this.tokens.length,b=[],c=0,d;c<a;c++){d=this.tokens[c];if(d.type_===N&&-1==b.indexOf(d.index_)){b.push(d.index_)}}return b},toJSFunction:function toJSFunction(a,b){var c=new Function(a,"with(Parser.values) { return "+this.simplify(b).toString(!0)+"; }");return c}};function i(c,a){return+c+ +a}function j(c,a){return c-a}function k(c,a){return c*a}function l(c,a){return c/a}function m(c,a){return c%a}function n(c,a){return""+c+a}function o(c,a){return c==a}function p(c,a){return c!=a}function q(c,a){return c>a}function r(c,a){return c<a}function s(c,a){return c>=a}function t(c,a){return c<=a}function u(c,a){return!!(c&&a)}function v(c,a){return!!(c||a)}function w(b){return Math.sinh?Math.sinh(b):(Math.exp(b)-Math.exp(-b))/2}function x(b){return Math.cosh?Math.cosh(b):(Math.exp(b)+Math.exp(-b))/2}function y(b){if(Math.tanh)return Math.tanh(b);if(b===1/0)return 1;if(b===-Infinity)return-1;return(Math.exp(b)-Math.exp(-b))/(Math.exp(b)+Math.exp(-b))}function z(b){if(Math.asinh)return Math.asinh(b);if(b===-Infinity)return b;return Math.log(b+Math.sqrt(b*b+1))}function A(b){return Math.acosh?Math.acosh(b):Math.log(b+Math.sqrt(b*b-1))}function B(b){return Math.atanh?Math.atanh(b):Math.log((1+b)/(1-b))/2}function C(b){return Math.log(b)*Math.LOG10E}function D(b){return-b}function E(b){if(Math.trunc)return Math.trunc(b);else return 0>b?Math.ceil(b):Math.floor(b)}function F(b){return Math.random()*(b||1)}function G(c){c=Math.floor(c);var d=c;while(1<c){d=d*--c}return d}function H(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var a=0,b=arguments.length,c=0;c<b;c++){if(arguments[c]===1/0||arguments[c]===-Infinity){return 1/0}a+=arguments[c]*arguments[c]}return Math.sqrt(a)}function I(a,b,c){return a?b:c}function J(c,d){if("[object Array]"!=Object.prototype.toString.call(c)){return[c,d]}c=c.slice();c.push(d);return c}function K(){this.success=!1;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:w,cosh:x,tanh:y,asinh:z,acosh:A,atanh:B,sqrt:Math.sqrt,log:Math.log,lg:C,log10:C,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:E,"-":D,exp:Math.exp};this.ops2={"+":i,"-":j,"*":k,"/":l,"%":m,"^":Math.pow,",":J,"||":n,"==":o,"!=":p,">":q,"<":r,">=":s,"<=":t,and:u,or:v};this.functions={random:F,fac:G,min:Math.min,max:Math.max,hypot:H,pyt:H,pow:Math.pow,atan2:Math.atan2,if:I};this.consts={E:Math.E,PI:Math.PI}}K.parse=function(a){return new K().parse(a)};K.evaluate=function(a,b){return K.parse(a).evaluate(b)};K.Expression=d;K.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:w,cosh:x,tanh:y,asinh:z,acosh:A,atanh:B,sqrt:Math.sqrt,log:Math.log,lg:C,log10:C,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:E,random:F,fac:G,exp:Math.exp,min:Math.min,max:Math.max,hypot:H,pyt:H,pow:Math.pow,atan2:Math.atan2,if:I,E:Math.E,PI:Math.PI};var R=2,S=4,T=8,U=16,V=32,W=64,X=128,Y=256;K.prototype={parse:function parse(a){this.errormsg="";this.success=!0;var e=[],f=[];this.tmpprio=0;var g=1|T|S|W,h=0;this.expression=a;this.pos=0;while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&g&W){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";h++;this.addfunc(f,e,L)}g=1|T|S|W}else if(!this.isComment()){if(0==(g&R)){this.error_parsing(this.pos,"unexpected operator")}h+=2;this.addfunc(f,e,M);g=1|T|S|W}}else if(this.isNumber()){if(0==(g&1)){this.error_parsing(this.pos,"unexpected number")}var i=new c(0,0,0,this.tokennumber);f.push(i);g=R|U|V}else if(this.isString()){if(0==(g&1)){this.error_parsing(this.pos,"unexpected string")}var i=new c(0,0,0,this.tokennumber);f.push(i);g=R|U|V}else if(this.isLeftParenth()){if(0==(g&T)){this.error_parsing(this.pos,"unexpected \"(\"")}if(g&X){h+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(f,e,O)}g=1|T|S|W|Y}else if(this.isRightParenth()){if(g&Y){var i=new c(0,0,0,[]);f.push(i)}else if(0==(g&U)){this.error_parsing(this.pos,"unexpected \")\"")}g=R|U|V|T|X}else if(this.isComma()){if(0==(g&V)){this.error_parsing(this.pos,"unexpected \",\"")}this.addfunc(f,e,M);h+=2;g=1|T|S|W}else if(this.isConst()){if(0==(g&1)){this.error_parsing(this.pos,"unexpected constant")}var j=new c(0,0,0,this.tokennumber);f.push(j);g=R|U|V}else if(this.isOp2()){if(0==(g&S)){this.error_parsing(this.pos,"unexpected function")}this.addfunc(f,e,M);h+=2;g=T}else if(this.isOp1()){if(0==(g&S)){this.error_parsing(this.pos,"unexpected function")}this.addfunc(f,e,L);h++;g=T}else if(this.isVar()){if(0==(g&1)){this.error_parsing(this.pos,"unexpected variable")}var k=new c(N,this.tokenindex,0,0);f.push(k);g=R|U|V|T|X}else if(!this.isWhite()){if(""===this.errormsg){this.error_parsing(this.pos,"unknown character")}else{this.error_parsing(this.pos,this.errormsg)}}}if(0>this.tmpprio||10<=this.tmpprio){this.error_parsing(this.pos,"unmatched \"()\"")}while(0<e.length){var l=e.pop();f.push(l)}if(h+1!==f.length){this.error_parsing(this.pos,"parity")}return new d(f,b(this.ops1),b(this.ops2),b(this.functions))},evaluate:function evaluate(a,b){return this.parse(a).evaluate(b)},error_parsing:function error_parsing(a,b){this.success=!1;this.errormsg="parse error [column "+a+"]: "+b;this.column=a;throw new Error(this.errormsg)},addfunc:function addfunc(a,b,d){var e=new c(d,this.tokenindex,this.tokenprio+this.tmpprio,0);while(0<b.length){if(e.prio_<=b[b.length-1].prio_){a.push(b.pop())}else{break}}b.push(e)},isNumber:function isNumber(){var a=!1,b="";while(this.pos<this.expression.length){var c=this.expression.charCodeAt(this.pos);if(48<=c&&57>=c||46===c){b+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(b);a=!0}else{break}}return a},unescape:function unescape(a,b){for(var d=[],e=!1,f=0,g;f<a.length;f++){g=a.charAt(f);if(e){switch(g){case"'":d.push("'");break;case"\\":d.push("\\");break;case"/":d.push("/");break;case"b":d.push("\b");break;case"f":d.push("\f");break;case"n":d.push("\n");break;case"r":d.push("\r");break;case"t":d.push("\t");break;case"u":var h=parseInt(a.substring(f+1,f+5),16);d.push(String.fromCharCode(h));f+=4;break;default:throw this.error_parsing(b+f,"Illegal escape sequence: '\\"+g+"'");}e=!1}else{if("\\"==g){e=!0}else{d.push(g)}}}return d.join("")},isString:function isString(){var a=!1,b="",c=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos)){this.pos++;while(this.pos<this.expression.length){var d=this.expression.charAt(this.pos);if("'"!=d||"\\"==b.slice(-1)){b+=this.expression.charAt(this.pos);this.pos++}else{this.pos++;this.tokennumber=this.unescape(b,c);a=!0;break}}}return a},isConst:function isConst(){var a;for(var b in this.consts){var c=b.length;a=this.expression.substr(this.pos,c);if(b===a){this.tokennumber=this.consts[b];this.pos+=c;return!0}}return!1},isOperator:function isOperator(){var a=this.expression.charCodeAt(this.pos);if(43===a){this.tokenprio=2;this.tokenindex="+"}else if(45===a){this.tokenprio=2;this.tokenindex="-"}else if(62===a){if(61===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=1;this.tokenindex=">="}else{this.tokenprio=1;this.tokenindex=">"}}else if(60===a){if(61===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=1;this.tokenindex="<="}else{this.tokenprio=1;this.tokenindex="<"}}else if(124===a){if(124===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=1;this.tokenindex="||"}else{return!1}}else if(61===a){if(61===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=1;this.tokenindex="=="}else{return!1}}else if(33===a){if(61===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=1;this.tokenindex="!="}else{return!1}}else if(97===a){if(110===this.expression.charCodeAt(this.pos+1)&&100===this.expression.charCodeAt(this.pos+2)){this.pos++;this.pos++;this.tokenprio=0;this.tokenindex="and"}else{return!1}}else if(111===a){if(114===this.expression.charCodeAt(this.pos+1)){this.pos++;this.tokenprio=0;this.tokenindex="or"}else{return!1}}else if(42===a||8729===a||8226===a){this.tokenprio=3;this.tokenindex="*"}else if(47===a){this.tokenprio=4;this.tokenindex="/"}else if(37===a){this.tokenprio=4;this.tokenindex="%"}else if(94===a){this.tokenprio=5;this.tokenindex="^"}else{return!1}this.pos++;return!0},isSign:function isSign(){var a=this.expression.charCodeAt(this.pos-1);if(45===a||43===a){return!0}return!1},isPositiveSign:function isPositiveSign(){var a=this.expression.charCodeAt(this.pos-1);if(43===a){return!0}return!1},isNegativeSign:function isNegativeSign(){var a=this.expression.charCodeAt(this.pos-1);if(45===a){return!0}return!1},isLeftParenth:function isLeftParenth(){var a=this.expression.charCodeAt(this.pos);if(40===a){this.pos++;this.tmpprio+=10;return!0}return!1},isRightParenth:function isRightParenth(){var a=this.expression.charCodeAt(this.pos);if(41===a){this.pos++;this.tmpprio-=10;return!0}return!1},isComma:function isComma(){var a=this.expression.charCodeAt(this.pos);if(44===a){this.pos++;this.tokenprio=-1;this.tokenindex=",";return!0}return!1},isWhite:function isWhite(){var a=this.expression.charCodeAt(this.pos);if(32===a||9===a||10===a||13===a){this.pos++;return!0}return!1},isOp1:function isOp1(){for(var a="",b=this.pos,d;b<this.expression.length;b++){d=this.expression.charAt(b);if(d.toUpperCase()===d.toLowerCase()){if(b===this.pos||"_"!=d&&("0">d||"9"<d)){break}}a+=d}if(0<a.length&&a in this.ops1){this.tokenindex=a;this.tokenprio=5;this.pos+=a.length;return!0}return!1},isOp2:function isOp2(){for(var a="",b=this.pos,d;b<this.expression.length;b++){d=this.expression.charAt(b);if(d.toUpperCase()===d.toLowerCase()){if(b===this.pos||"_"!=d&&("0">d||"9"<d)){break}}a+=d}if(0<a.length&&a in this.ops2){this.tokenindex=a;this.tokenprio=5;this.pos+=a.length;return!0}return!1},isVar:function isVar(){for(var a="",b=this.pos,d;b<this.expression.length;b++){d=this.expression.charAt(b);if(d.toUpperCase()===d.toLowerCase()){if(b===this.pos||"_"!=d&&"."!=d&&("0">d||"9"<d)){break}}a+=d}if(0<a.length){this.tokenindex=a;this.tokenprio=4;this.pos+=a.length;return!0}return!1},isComment:function isComment(){var a=this.expression.charCodeAt(this.pos-1);if(47===a&&42===this.expression.charCodeAt(this.pos)){this.pos=this.expression.indexOf("*/",this.pos)+2;if(1===this.pos){this.pos=this.expression.length}return!0}return!1}};a.Parser=K;return K}("undefined"==typeof exports?{}:exports);
//# sourceMappingURL=parser.min.js.map
